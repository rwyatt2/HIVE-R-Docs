"use strict";(globalThis.webpackChunktemp_docs=globalThis.webpackChunktemp_docs||[]).push([[1600],{543(n,e,s){s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>a,frontMatter:()=>l,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"production-readiness/phase-2-cost-monitoring","title":"Phase 2: Cost Monitoring Infrastructure","description":"\u23f1\ufe0f Time: 6-8 hours","source":"@site/docs/production-readiness/03-phase-2-cost-monitoring.md","sourceDirName":"production-readiness","slug":"/production-readiness/phase-2-cost-monitoring","permalink":"/HIVE-R-Docs/docs/production-readiness/phase-2-cost-monitoring","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/production-readiness/03-phase-2-cost-monitoring.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Phase 2: Cost Monitoring Infrastructure","sidebar_label":"Phase 2: Cost Monitoring Infrastructure"},"sidebar":"tutorialSidebar","previous":{"title":"Phase 1: Emergency Security Fixes","permalink":"/HIVE-R-Docs/docs/production-readiness/phase-1-security"},"next":{"title":"Phase 3: Test Suite Generation","permalink":"/HIVE-R-Docs/docs/production-readiness/phase-3-test-suite"}}');var i=s(4848),t=s(8453);const l={title:"Phase 2: Cost Monitoring Infrastructure",sidebar_label:"Phase 2: Cost Monitoring Infrastructure"},c="Run migration",d={},o=[];function h(n){const e={a:"a",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.p,{children:"**"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u23f1\ufe0f Time"}),": 6-8 hours"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\ud83d\udcb0 Budget"}),": $10-15"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\ud83c\udfaf Goal"}),": Real-time visibility into AI API costs"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\ud83e\udd16 AI Workers"}),": HIVE-R Builder + Data Analyst agents"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\ud83d\udcb0 Step 2.1: Create Cost Tracking Schema"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Your Instruction"})," (in Cursor):"]}),"\n",(0,i.jsx)(e.p,{children:"Consult the HIVE-R swarm."}),"\n",(0,i.jsx)(e.p,{children:"CONTEXT:"}),"\n",(0,i.jsx)(e.p,{children:"We need to track every LLM API call with: agent name, model, tokens in/out, cost, timestamp, latency."}),"\n",(0,i.jsx)(e.p,{children:"TASK:"}),"\n",(0,i.jsx)(e.p,{children:"Data Analyst agent: Design optimal schema for cost tracking"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - What fields do we need?"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - What indexes for fast queries?"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Daily/weekly/monthly aggregation strategy?"}),"\n",(0,i.jsx)(e.p,{children:"Builder agent: Implement the schema"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Update src/lib/db.ts (or create new migration)"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Add TypeScript types"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Create helper functions: logUsage(), getDailyCost(), getAgentCosts()"}),"\n",(0,i.jsx)(e.p,{children:"REQUIREMENTS:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Compatible with existing SQLite database"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Efficient queries (add indexes)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"No breaking changes to existing tables"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"DELIVERABLES:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Schema in docs/architecture/cost-tracking-schema.md"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Migration script: scripts/migrations/001-add-cost-tracking.sql"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"TypeScript types: src/types/cost-tracking.ts"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Helper functions: src/lib/cost-tracker.ts"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Tests: tests/lib/cost-tracker.test.ts"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u23f8\ufe0f YOUR APPROVAL GATE"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"Review the schema design:"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Includes all necessary fields (see analysis section 5.1)"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Has indexes on timestamp and agent name (for fast queries)"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Migration is reversible (has DOWN script)"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Example of what you're looking for"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"CREATE TABLE IF NOT EXISTS token_usage ("}),"\n",(0,i.jsx)(e.p,{children:"\xa0 id INTEGER PRIMARY KEY AUTOINCREMENT,"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 agent_name TEXT NOT NULL,"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 model TEXT NOT NULL,"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 tokens_input INTEGER,"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 tokens_output INTEGER,"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 cost_usd REAL,"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 latency_ms INTEGER,"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 user_id TEXT,"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 session_id TEXT"}),"\n",(0,i.jsx)(e.p,{children:");"}),"\n",(0,i.jsx)(e.p,{children:"CREATE INDEX idx_token_usage_timestamp ON token_usage(timestamp);"}),"\n",(0,i.jsx)(e.p,{children:"CREATE INDEX idx_token_usage_agent ON token_usage(agent_name);"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Approve"}),': "Schema looks good, proceed with implementation"']}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Test"}),":"]}),"\n",(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"run-migration",children:"Run migration"})}),"\n",(0,i.jsxs)(e.p,{children:["npm run db",":migrate"]}),"\n",(0,i.jsx)(e.h1,{id:"verify-table-exists",children:"Verify table exists"}),"\n",(0,i.jsx)(e.p,{children:"sqlite3 data/hive.db \"SELECT sql FROM sqlite_master WHERE name='token_usage';\""}),"\n",(0,i.jsx)(e.h1,{id:"run-tests",children:"Run tests"}),"\n",(0,i.jsx)(e.p,{children:"npm test tests/lib/cost-tracker.test.ts"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u2705 Validation"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Migration runs successfully"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Table has correct schema"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Indexes created"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Tests pass"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\ud83d\udcca Log Cost"}),": ~$0.08 (25K tokens)"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\ud83d\udcca Step 2.2: Integrate Cost Tracking Middleware"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Your Instruction"})," (in Cursor, open src/index.ts):"]}),"\n",(0,i.jsx)(e.p,{children:"Consult the Builder agent."}),"\n",(0,i.jsx)(e.p,{children:"CONTEXT:"}),"\n",(0,i.jsx)(e.p,{children:"We have cost tracking functions (src/lib/cost-tracker.ts) but they're not hooked into actual LLM calls."}),"\n",(0,i.jsx)(e.p,{children:"TASK:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Create middleware that wraps every LLM call"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Extract token usage from LangChain response metadata"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Calculate cost based on model pricing"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Log to token_usage table"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Check against daily budget limit ($50 default)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Throw error if budget exceeded"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"PRICING (hardcode these):"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"gpt-4o: $0.005 input, $0.015 output (per 1K tokens)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"gpt-4o-mini: $0.00015 input, $0.0006 output"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"claude-3-5-sonnet: $0.003 input, $0.015 output"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"claude-3-haiku: $0.00025 input, $0.00125 output"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"INTEGRATION POINTS:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"src/agents/router.ts (wraps GPT-4o call)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"src/agents/builder.ts (wraps Claude call)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"All other agent files"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"REQUIREMENTS:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Use LangChain callbacks to get token counts"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Minimal performance overhead"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Graceful failure (log error but don't break request)"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"DELIVERABLES:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Middleware: src/middleware/cost-tracking.ts"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Integration in all agent files"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Budget config: DAILY_BUDGET in .env"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Tests with mocked LLM calls"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u23f8\ufe0f YOUR APPROVAL GATE"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"Check the integration approach:"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Uses LangChain callbacks (not custom parsing)"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Pricing constants are correct"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Budget check happens AFTER logging (so you see what caused overage)"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Doesn't slow down requests significantly"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Test manually"}),":"]}),"\n",(0,i.jsx)(e.h1,{id:"set-low-budget-for-testing",children:"Set low budget for testing"}),"\n",(0,i.jsx)(e.p,{children:'echo "DAILY_BUDGET=0.10" >> .env'}),"\n",(0,i.jsx)(e.h1,{id:"make-several-requests-until-budget-exceeded",children:"Make several requests until budget exceeded"}),"\n",(0,i.jsxs)(e.p,{children:["curl -X POST ",(0,i.jsx)(e.a,{href:"http://localhost:3000/chat",children:"http://localhost:3000/chat"})," \\"]}),"\n",(0,i.jsx)(e.p,{children:'\xa0 -H "Authorization: Bearer $TOKEN" \\'}),"\n",(0,i.jsx)(e.p,{children:'\xa0 -d \'{"messages":[{"role":"user","content":"Hello"}]}\''}),"\n",(0,i.jsx)(e.h1,{id:"should-eventually-return-budget-exceeded-error",children:"Should eventually return budget exceeded error"}),"\n",(0,i.jsx)(e.h1,{id:"check-logs",children:"Check logs"}),"\n",(0,i.jsx)(e.p,{children:"sqlite3 data/hive.db \"SELECT SUM(cost_usd) FROM token_usage WHERE date(timestamp) = date('now');\""}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u2705 Validation"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Each LLM call logs to token_usage table"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Costs calculated accurately"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Budget enforcement works"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Performance <10ms overhead per call"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\ud83d\udcca Log Cost"}),": ~$0.10 (30K tokens)"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\ud83d\udcc8 Step 2.3: Build Cost Dashboard API"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Your Instruction"})," (in Cursor):"]}),"\n",(0,i.jsx)(e.p,{children:"Consult the Data Analyst and Builder agents."}),"\n",(0,i.jsx)(e.p,{children:"CONTEXT:"}),"\n",(0,i.jsx)(e.p,{children:"We're tracking costs in the database. Now we need API endpoints to visualize them."}),"\n",(0,i.jsx)(e.p,{children:"TASK:"}),"\n",(0,i.jsx)(e.p,{children:"Data Analyst: Design queries for these views:"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Today's total cost"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Cost per agent (today/week/month)"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Cost trend over time (daily aggregates)"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Top 5 most expensive queries"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Projected monthly cost (based on current burn rate)"}),"\n",(0,i.jsx)(e.p,{children:"Builder: Implement REST API endpoints:"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - GET /api/admin/costs/today"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - GET /api/admin/costs/by-agent?period=today|week|month"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - GET /api/admin/costs/trend?days=30"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - GET /api/admin/costs/top-queries?limit=10"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - GET /api/admin/costs/projection"}),"\n",(0,i.jsx)(e.p,{children:"REQUIREMENTS:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Require admin authentication (not all users)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Efficient queries (use indexes)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Cache results for 5 minutes (Redis or in-memory)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Return JSON with clear structure"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"DELIVERABLES:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"New router: src/routers/admin/costs.ts"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Integration in src/routers/admin.ts"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"API documentation: docs/api/costs.md"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Tests: tests/routers/admin/costs.test.ts"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u23f8\ufe0f YOUR APPROVAL GATE"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"Review the query designs:"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Use proper SQL aggregations (not loading all rows into memory)"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Have LIMIT clauses to prevent huge responses"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Cache expensive queries"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Test"}),":"]}),"\n",(0,i.jsx)(e.h1,{id:"generate-some-usage-data-first",children:"Generate some usage data first"}),"\n",(0,i.jsx)(e.p,{children:"npm run scripts/generate-test-data.ts"}),"\n",(0,i.jsx)(e.h1,{id:"test-endpoints",children:"Test endpoints"}),"\n",(0,i.jsxs)(e.p,{children:["curl ",(0,i.jsx)(e.a,{href:"http://localhost:3000/api/admin/costs/today",children:"http://localhost:3000/api/admin/costs/today"})," \\"]}),"\n",(0,i.jsx)(e.p,{children:'\xa0 -H "Authorization: Bearer $ADMIN_TOKEN" | jq'}),"\n",(0,i.jsx)(e.h1,{id:"should-return",children:"Should return:"}),"\n",(0,i.jsx)(e.h1,{id:"",children:"{"}),"\n",(0,i.jsx)(e.h1,{id:"-date-2026-02-07",children:'\xa0 "date": "2026-02-07",'}),"\n",(0,i.jsx)(e.h1,{id:"-total_cost-125",children:'\xa0 "total_cost": 1.25,'}),"\n",(0,i.jsx)(e.h1,{id:"-total_requests-47",children:'\xa0 "total_requests": 47,'}),"\n",(0,i.jsx)(e.h1,{id:"-by_agent-",children:'\xa0 "by_agent": {...}'}),"\n",(0,i.jsx)(e.h1,{id:"-1",children:"}"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u2705 Validation"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"\u2610 All endpoints return valid JSON"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Queries are fast (<100ms)"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Auth required (401 without token)"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Numbers match database totals"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\ud83d\udcca Log Cost"}),": ~$0.12 (35K tokens)"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\ud83c\udfa8 Step 2.4: Build Cost Dashboard Frontend"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Your Instruction"})," (in Cursor, open client/src/pages/Dashboard.tsx):"]}),"\n",(0,i.jsx)(e.p,{children:"Consult the Designer and Builder agents."}),"\n",(0,i.jsx)(e.p,{children:"CONTEXT:"}),"\n",(0,i.jsx)(e.p,{children:"We have cost API endpoints. Now we need a dashboard to visualize them."}),"\n",(0,i.jsx)(e.p,{children:"TASK:"}),"\n",(0,i.jsx)(e.p,{children:"Designer: Propose dashboard layout with:"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Big number cards (today's cost, this month, projection)"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Bar chart (cost per agent)"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Line chart (cost trend over 30 days)"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Table (top 10 expensive queries)"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Budget gauge (e.g., $45 / $50 daily limit)"}),"\n",(0,i.jsx)(e.p,{children:"Builder: Implement React components:"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Use existing UI components from client/src/components/"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Fetch data from /api/admin/costs/* endpoints"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Auto-refresh every 30 seconds"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Loading states and error handling"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Responsive (mobile + desktop)"}),"\n",(0,i.jsx)(e.p,{children:"REQUIREMENTS:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Match existing design system (check client/src/styles/)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Use Chart.js or Recharts for visualizations"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"No external design libraries (use your existing CSS)"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"DELIVERABLES:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Updated Dashboard.tsx with cost metrics"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"New component: CostDashboard.tsx"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Chart components (if needed)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"CSS in Dashboard.module.css"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u23f8\ufe0f YOUR APPROVAL GATE"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"Review the design mockup (Designer will provide):"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Layout is clean and readable"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Most important metric (today's cost) is prominent"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Color coding (green = under budget, yellow = approaching, red = over)"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Approve"}),': "Design approved, implement it"']}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Test"}),":"]}),"\n",(0,i.jsx)(e.h1,{id:"start-frontend-dev-server",children:"Start frontend dev server"}),"\n",(0,i.jsx)(e.p,{children:"cd client && npm run dev"}),"\n",(0,i.jsxs)(e.h1,{id:"open-httplocalhost5173",children:["Open ",(0,i.jsx)(e.a,{href:"http://localhost:5173",children:"http://localhost:5173"})]}),"\n",(0,i.jsx)(e.h1,{id:"navigate-to-dashboard",children:"Navigate to Dashboard"}),"\n",(0,i.jsx)(e.h1,{id:"should-see-cost-metrics-updating",children:"Should see cost metrics updating"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u2705 Validation"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Dashboard loads without errors"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Numbers match API responses"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Charts render correctly"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Auto-refresh works"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Mobile responsive"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\ud83d\udcca Log Cost"}),": ~$0.15 (45K tokens - includes frontend code)"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\ud83d\udea8 Step 2.5: Implement Budget Alerts"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Your Instruction"})," (in Cursor):"]}),"\n",(0,i.jsx)(e.p,{children:"Consult the SRE and Builder agents."}),"\n",(0,i.jsx)(e.p,{children:"CONTEXT:"}),"\n",(0,i.jsx)(e.p,{children:"We can track costs, but we need proactive alerts BEFORE we blow the budget."}),"\n",(0,i.jsx)(e.p,{children:"TASK:"}),"\n",(0,i.jsx)(e.p,{children:"Design alert system with:"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Check every 10 minutes (cron job or setInterval)"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Alert thresholds: 50%, 80%, 100%, 120% of daily budget"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Alert channels: Log to console, Send to Slack (if SLACK_WEBHOOK configured), Email (optional)"}),"\n",(0,i.jsx)(e.p,{children:"Implementation:"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - New service: src/services/budget-alerts.ts"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Tracks which alerts have fired (don't spam same alert)"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Graceful degradation (if Slack fails, still log)"}),"\n",(0,i.jsx)(e.p,{children:"Integration:"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Start service on server boot"}),"\n",(0,i.jsx)(e.p,{children:"\xa0 - Expose /api/admin/alerts endpoint to see history"}),"\n",(0,i.jsx)(e.p,{children:"DELIVERABLES:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Budget alert service"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Slack integration (optional)"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Alert history API"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Documentation in docs/operations/cost-alerts.md"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u23f8\ufe0f YOUR APPROVAL GATE"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"Review alert logic:"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Won't spam (tracks already-sent alerts)"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Has kill switch (can disable via env var)"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Logs to file as backup (in case Slack is down)"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Test"}),":"]}),"\n",(0,i.jsx)(e.h1,{id:"set-very-low-budget-to-trigger-alert",children:"Set very low budget to trigger alert"}),"\n",(0,i.jsx)(e.p,{children:'echo "DAILY_BUDGET=0.05" >> .env'}),"\n",(0,i.jsx)(e.p,{children:"npm run dev"}),"\n",(0,i.jsx)(e.h1,{id:"make-requests-until-you-hit-50-of-budget",children:"Make requests until you hit 50% of budget"}),"\n",(0,i.jsx)(e.h1,{id:"check-console-logs-for-alert",children:"Check console logs for alert"}),"\n",(0,i.jsx)(e.h1,{id:"if-slack-configured",children:"If Slack configured:"}),"\n",(0,i.jsx)(e.h1,{id:"check-your-slack-channel-for-alert-message",children:"Check your Slack channel for alert message"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u2705 Validation"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Alerts fire at correct thresholds"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 No duplicate alerts in same period"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Slack integration works (if configured)"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 System doesn't crash if Slack fails"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\ud83d\udcca Log Cost"}),": ~$0.08 (25K tokens)"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 Phase 2 Complete When:"})}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Cost tracking logs every LLM call"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Dashboard shows real-time costs"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Budget alerts fire correctly"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 APIs documented"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Tests passing"}),"\n",(0,i.jsx)(e.p,{children:"\u2610 Total cost <$15 for Phase 2"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\ud83d\udca1 Key Insight"}),": You can now see exactly where money is going and prevent runaway costs."]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\ud83d\udcf8 Take Screenshot"}),": Of your cost dashboard showing real data. This is your proof of progress."]}),"\n",(0,i.jsx)(e.p,{children:"**"})]})}function a(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},8453(n,e,s){s.d(e,{R:()=>l,x:()=>c});var r=s(6540);const i={},t=r.createContext(i);function l(n){const e=r.useContext(t);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:l(n.components),r.createElement(t.Provider,{value:e},n.children)}}}]);