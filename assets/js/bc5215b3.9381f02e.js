"use strict";(globalThis.webpackChunktemp_docs=globalThis.webpackChunktemp_docs||[]).push([[9304],{378(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>o,frontMatter:()=>t,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"production-readiness/phase-4-reliability","title":"Phase 4: Reliability & Fallbacks","description":"\u23f1\ufe0f Time: 8-10 hours","source":"@site/docs/production-readiness/05-phase-4-reliability.md","sourceDirName":"production-readiness","slug":"/production-readiness/phase-4-reliability","permalink":"/HIVE-R-Docs/docs/production-readiness/phase-4-reliability","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/production-readiness/05-phase-4-reliability.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Phase 4: Reliability & Fallbacks","sidebar_label":"Phase 4: Reliability & Fallbacks"},"sidebar":"tutorialSidebar","previous":{"title":"Phase 3: Test Suite Generation","permalink":"/HIVE-R-Docs/docs/production-readiness/phase-3-test-suite"},"next":{"title":"Phase 5: Observability Stack","permalink":"/HIVE-R-Docs/docs/production-readiness/phase-5-observability"}}');var i=s(4848),l=s(8453);const t={title:"Phase 4: Reliability & Fallbacks",sidebar_label:"Phase 4: Reliability & Fallbacks"},c="Start server",a={},h=[];function d(e){const n={a:"a",h1:"h1",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"**"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u23f1\ufe0f Time"}),": 8-10 hours"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udcb0 Budget"}),": $15-20"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83c\udfaf Goal"}),": System survives LLM API outages"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83e\udd16 AI Workers"}),": HIVE-R SRE + Builder agents"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\ud83d\udd04 Step 4.1: Implement Circuit Breaker"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Your Instruction"})," (in Cursor):"]}),"\n",(0,i.jsx)(n.p,{children:"Consult the SRE and Builder agents."}),"\n",(0,i.jsx)(n.p,{children:"CONTEXT:"}),"\n",(0,i.jsx)(n.p,{children:"If OpenAI/Anthropic APIs go down, our entire system crashes. We need circuit breaker pattern."}),"\n",(0,i.jsx)(n.p,{children:"TASK:"}),"\n",(0,i.jsx)(n.p,{children:"Implement circuit breaker for all LLM calls with these states:"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 1. CLOSED (normal operation)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 2. OPEN (too many failures, stop calling API)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 3. HALF-OPEN (try one request to test if API recovered)"}),"\n",(0,i.jsx)(n.p,{children:"CONFIGURATION:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Max failures: 3"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Timeout: 60 seconds (after 3 failures, wait 60s before retry)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Track separately per model (OpenAI circuit != Anthropic circuit)"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"IMPLEMENTATION:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"New class: src/lib/circuit-breaker.ts"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Wrap all LLM calls (in middleware or agent wrapper)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Emit events: circuit_opened, circuit_closed"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Log to monitoring system"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"REQUIREMENTS:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Thread-safe (if we add workers later)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Configurable via environment variables"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Graceful errors (user-friendly messages)"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"DELIVERABLES:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"CircuitBreaker class with tests"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Integration in src/middleware/llm-wrapper.ts"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Monitoring dashboard shows circuit state"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Documentation"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u23f8\ufe0f YOUR APPROVAL GATE"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"Review the circuit breaker logic:"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 States transition correctly (CLOSED \u2192 OPEN \u2192 HALF_OPEN \u2192 CLOSED)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Timeouts are reasonable (60s, not 10 minutes)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Per-model tracking (OpenAI issues don't break Anthropic)"}),"\n",(0,i.jsx)(n.p,{children:'\u2610 User gets friendly error: "AI service temporarily unavailable"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Test manually"}),":"]}),"\n",(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"start-server",children:"Start server"})}),"\n",(0,i.jsx)(n.p,{children:"npm run dev"}),"\n",(0,i.jsx)(n.h1,{id:"simulate-api-failure-block-network-to-apiopenaicom",children:"Simulate API failure (block network to api.openai.com)"}),"\n",(0,i.jsx)(n.p,{children:"sudo iptables -A OUTPUT -d api.openai.com -j DROP"}),"\n",(0,i.jsx)(n.h1,{id:"make-requests-until-circuit-opens",children:"Make requests until circuit opens"}),"\n",(0,i.jsxs)(n.p,{children:["curl ",(0,i.jsx)(n.a,{href:"http://localhost:3000/chat",children:"http://localhost:3000/chat"})," [repeat 3 times]"]}),"\n",(0,i.jsx)(n.h1,{id:"should-get-circuit-breaker-open-error",children:'Should get "Circuit breaker open" error'}),"\n",(0,i.jsx)(n.h1,{id:"restore-network",children:"Restore network"}),"\n",(0,i.jsx)(n.p,{children:"sudo iptables -D OUTPUT -d api.openai.com -j DROP"}),"\n",(0,i.jsx)(n.h1,{id:"wait-60-seconds-try-again",children:"Wait 60 seconds, try again"}),"\n",(0,i.jsx)(n.h1,{id:"circuit-should-move-to-half_open-then-closed",children:"Circuit should move to HALF_OPEN, then CLOSED"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Validation"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Circuit opens after 3 failures"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Circuit closes after successful recovery"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Users get clear error messages"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 System doesn't crash during outage"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udcca Log Cost"}),": ~$0.10 (30K tokens)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\ud83d\udd00 Step 4.2: Add Model Fallbacks"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Your Instruction"})," (in Cursor, open src/agents/router.ts):"]}),"\n",(0,i.jsx)(n.p,{children:"Consult the SRE agent."}),"\n",(0,i.jsx)(n.p,{children:"CONTEXT:"}),"\n",(0,i.jsx)(n.p,{children:"Router uses GPT-4o exclusively. If OpenAI is down, routing fails entirely."}),"\n",(0,i.jsx)(n.p,{children:"TASK:"}),"\n",(0,i.jsx)(n.p,{children:"Implement fallback chain:"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 1. Primary: GPT-4o with structured output"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 2. Fallback 1: GPT-4o without structured output (parse text)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 3. Fallback 2: Claude 3.5 Sonnet"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 4. Final fallback: Rule-based router (no LLM)"}),"\n",(0,i.jsx)(n.p,{children:"RULE-BASED LOGIC:"}),"\n",(0,i.jsx)(n.p,{children:"If all LLMs fail, use simple keyword matching:"}),"\n",(0,i.jsx)(n.p,{children:'\xa0 - "build", "code", "implement" \u2192 builder'}),"\n",(0,i.jsx)(n.p,{children:'\xa0 - "design", "UI", "UX" \u2192 designer'}),"\n",(0,i.jsx)(n.p,{children:'\xa0 - "security", "vulnerability" \u2192 security'}),"\n",(0,i.jsx)(n.p,{children:'\xa0 - "deploy", "production" \u2192 sre'}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Default \u2192 product_manager (safe choice)"}),"\n",(0,i.jsx)(n.p,{children:"IMPLEMENTATION:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Try each fallback in sequence"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Log which fallback was used (for monitoring)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Track fallback usage (how often primary fails?)"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"DELIVERABLES:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Enhanced router with fallback chain"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Rule-based fallback function"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Metrics: fallback_usage_count by level"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Tests for each fallback scenario"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u23f8\ufe0f YOUR APPROVAL GATE"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"Review the fallback logic:"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Fallback order makes sense (cost-aware: expensive \u2192 cheap \u2192 free)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Rule-based router is sensible (covers common cases)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Each fallback is tested"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Logs clearly show which fallback was used"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Test"}),":"]}),"\n",(0,i.jsx)(n.h1,{id:"mock-failures-to-test-fallbacks",children:"Mock failures to test fallbacks"}),"\n",(0,i.jsx)(n.h1,{id:"use-environment-variable-to-force-fallback-mode",children:"Use environment variable to force fallback mode"}),"\n",(0,i.jsx)(n.p,{children:"FORCE_FALLBACK_LEVEL=2 npm run dev"}),"\n",(0,i.jsx)(n.h1,{id:"make-request-check-logs",children:"Make request, check logs"}),"\n",(0,i.jsxs)(n.p,{children:["curl ",(0,i.jsx)(n.a,{href:"http://localhost:3000/chat",children:"http://localhost:3000/chat"}),' -d \'{"messages":[{"role":"user","content":"build me a login page"}]}\'']}),"\n",(0,i.jsx)(n.h1,{id:"log-should-show-router-fallback-level-2-claude-used",children:'Log should show: "Router fallback level 2 (Claude) used"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Validation"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Fallback chain works correctly"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Rule-based router handles common cases"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Performance acceptable (fallbacks don't add 10s delay)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Metrics track fallback usage"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udcca Log Cost"}),": ~$0.12 (35K tokens)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\ud83d\udd01 Step 4.3: Add Retry Logic with Exponential Backoff"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Your Instruction"})," (in Cursor):"]}),"\n",(0,i.jsx)(n.p,{children:"Consult the Builder agent."}),"\n",(0,i.jsx)(n.p,{children:"CONTEXT:"}),"\n",(0,i.jsx)(n.p,{children:"Transient errors (rate limits, network hiccups) should be retried, not immediately failed."}),"\n",(0,i.jsx)(n.p,{children:"TASK:"}),"\n",(0,i.jsx)(n.p,{children:"Implement retry logic for all LLM API calls:"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Max retries: 3"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Backoff strategy: exponential (1s, 2s, 4s)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Retry on: 429 (rate limit), 500 (server error), network timeout"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Don't retry on: 400 (bad request), 401 (auth error)"}),"\n",(0,i.jsx)(n.p,{children:"INTEGRATION:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Add to LLM wrapper middleware"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Works with circuit breaker (retries before opening circuit)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Configurable via environment variables"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"REQUIREMENTS:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Use existing retry library (p-retry or tenacity.js)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Log each retry attempt"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Add jitter to prevent thundering herd"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"DELIVERABLES:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Retry wrapper: src/lib/retry.ts"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Integration in LLM middleware"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Tests with mocked failures"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Documentation on retry behavior"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u23f8\ufe0f YOUR APPROVAL GATE"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"Review retry configuration:"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Max 3 retries (not infinite loop)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Exponential backoff (not fixed delay)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Jitter added (randomizes delay slightly)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Only retries transient errors (not auth failures)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Test"}),":"]}),"\n",(0,i.jsx)(n.h1,{id:"mock-transient-failure-rate-limit",children:"Mock transient failure (rate limit)"}),"\n",(0,i.jsx)(n.h1,{id:"test-that-system-retries-3-times-then-fails",children:"Test that system retries 3 times, then fails"}),"\n",(0,i.jsx)(n.p,{children:"npm test tests/lib/retry.test.ts"}),"\n",(0,i.jsx)(n.h1,{id:"check-test-includes",children:"Check test includes:"}),"\n",(0,i.jsx)(n.h1,{id:"--succeeds-on-2nd-attempt",children:"- Succeeds on 2nd attempt"}),"\n",(0,i.jsx)(n.h1,{id:"--fails-after-3-attempts",children:"- Fails after 3 attempts"}),"\n",(0,i.jsx)(n.h1,{id:"--respects-backoff-timing",children:"- Respects backoff timing"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Validation"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Retries transient errors"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Respects max retry limit"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Backoff timing correct"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Doesn't retry non-transient errors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udcca Log Cost"}),": ~$0.08 (25K tokens)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\ud83c\udfe5 Step 4.4: Health Check System"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Your Instruction"})," (in Cursor):"]}),"\n",(0,i.jsx)(n.p,{children:"Consult the SRE agent."}),"\n",(0,i.jsx)(n.p,{children:"CONTEXT:"}),"\n",(0,i.jsx)(n.p,{children:"We have /health/live and /health/ready endpoints but they're basic. Enhance them."}),"\n",(0,i.jsx)(n.p,{children:"TASK:"}),"\n",(0,i.jsx)(n.p,{children:"Implement comprehensive health checks:"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - /health/live: Is process alive? (Always 200 unless crashed)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - /health/ready: Is system ready to serve traffic?"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 \xa0 - Database connection OK?"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 \xa0 - LLM APIs reachable?"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 \xa0 - Circuit breakers not all open?"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 \xa0 - Disk space available?"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 \xa0 - Memory usage < 90%?"}),"\n",(0,i.jsx)(n.p,{children:"RESPONSE FORMAT:"}),"\n",(0,i.jsx)(n.p,{children:"{"}),"\n",(0,i.jsx)(n.p,{children:'\xa0 "status": "healthy" | "degraded" | "unhealthy",'}),"\n",(0,i.jsx)(n.p,{children:'\xa0 "checks": {'}),"\n",(0,i.jsx)(n.p,{children:'\xa0 \xa0 "database": {"status": "ok", "latency_ms": 5},'}),"\n",(0,i.jsx)(n.p,{children:'\xa0 \xa0 "openai_api": {"status": "ok", "circuit": "closed"},'}),"\n",(0,i.jsx)(n.p,{children:'\xa0 \xa0 "anthropic_api": {"status": "ok", "circuit": "closed"},'}),"\n",(0,i.jsx)(n.p,{children:'\xa0 \xa0 "disk_space": {"status": "ok", "free_gb": 42},'}),"\n",(0,i.jsx)(n.p,{children:'\xa0 \xa0 "memory": {"status": "ok", "usage_pct": 65}'}),"\n",(0,i.jsx)(n.p,{children:"\xa0 },"}),"\n",(0,i.jsx)(n.p,{children:'\xa0 "timestamp": "2026-02-07T12:34:56Z"'}),"\n",(0,i.jsx)(n.p,{children:"}"}),"\n",(0,i.jsx)(n.p,{children:"DELIVERABLES:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Enhanced health check: src/routers/health.ts"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Health check functions: src/lib/health-checks.ts"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Tests for each check"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Kubernetes liveness/readiness probes configured"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u23f8\ufe0f YOUR APPROVAL GATE"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"Review health check logic:"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Checks are fast (<500ms total)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Doesn't make expensive calls (test with cheap query)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Returns 503 (not 200) when unhealthy"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Kubernetes probes use correct endpoints"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Test"}),":"]}),"\n",(0,i.jsx)(n.h1,{id:"healthy-system",children:"Healthy system"}),"\n",(0,i.jsxs)(n.p,{children:["curl ",(0,i.jsx)(n.a,{href:"http://localhost:3000/health/ready",children:"http://localhost:3000/health/ready"})]}),"\n",(0,i.jsx)(n.h1,{id:"should-return-200-with-all-checks-ok",children:'Should return 200 with all checks "ok"'}),"\n",(0,i.jsx)(n.h1,{id:"simulate-unhealthy-stop-database",children:"Simulate unhealthy (stop database)"}),"\n",(0,i.jsx)(n.p,{children:"docker stop hive-postgres"}),"\n",(0,i.jsxs)(n.p,{children:["curl ",(0,i.jsx)(n.a,{href:"http://localhost:3000/health/ready",children:"http://localhost:3000/health/ready"})]}),"\n",(0,i.jsx)(n.h1,{id:"should-return-503-with-database-check-failed",children:'Should return 503 with database check "failed"'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Validation"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Health checks detect real issues"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Fast response (<500ms)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Kubernetes probes configured"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Monitoring system scrapes /health/ready"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udcca Log Cost"}),": ~$0.08 (25K tokens)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\ud83d\udcdd Step 4.5: Document Failure Scenarios"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Your Instruction"})," (in Cursor):"]}),"\n",(0,i.jsx)(n.p,{children:"Consult the Tech Writer and SRE agents."}),"\n",(0,i.jsx)(n.p,{children:"TASK:"}),"\n",(0,i.jsx)(n.p,{children:"Create runbook for common failure scenarios:"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 1. OpenAI API down \u2192 What happens? (circuit breaker, fallback to Claude)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 2. Database locked \u2192 How to recover? (restart, check for long-running queries)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 3. Memory leak \u2192 How to detect and mitigate? (health checks, auto-restart)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 4. Budget exceeded \u2192 What to do? (alerts fired, manual intervention)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 5. Agent stuck in loop \u2192 How to break? (timeout, manual kill)"}),"\n",(0,i.jsx)(n.p,{children:"FORMAT:"}),"\n",(0,i.jsx)(n.p,{children:"For each scenario:"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Symptoms (how you'll know it's happening)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Detection (which monitoring alert fires)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Impact (what breaks for users)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Automatic mitigation (what system does)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Manual intervention (what human should do)"}),"\n",(0,i.jsx)(n.p,{children:"\xa0 - Prevention (how to avoid in future)"}),"\n",(0,i.jsx)(n.p,{children:"OUTPUT:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"docs/operations/runbook.md"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Link from README for operators"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u23f8\ufe0f YOUR APPROVAL GATE"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"Review the runbook:"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Covers the 5 most likely failures"}),"\n",(0,i.jsx)(n.p,{children:'\u2610 Actionable steps (not vague "investigate")'}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Includes commands to run (copy-pasteable)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Has escalation path (who to call if manual steps fail)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u2705 Validation"}),":"]}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Runbook exists and is comprehensive"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 You understand how to respond to each scenario"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Commands tested (actually work)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udcca Log Cost"}),": ~$0.05 (15K tokens)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u2705 Phase 4 Complete When:"})}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Circuit breaker implemented and tested"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Model fallbacks working (4-level chain)"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Retry logic active"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Health checks comprehensive"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Runbook documented"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 System survives simulated OpenAI outage"}),"\n",(0,i.jsx)(n.p,{children:"\u2610 Total cost <$20 for Phase 4"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udca1 Key Insight"}),": Your system can now withstand LLM API outages without crashing."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\ud83d\udc1d HIVE-R Production Readiness Guide (CONTINUED)"})}),"\n",(0,i.jsx)(n.p,{children:"**"})]})}function o(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>c});var r=s(6540);const i={},l=r.createContext(i);function t(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);